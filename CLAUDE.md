# Gilbling - 聚美美数据可视化增强插件

凯哥，这是一个专为聚美美数据平台设计的Chrome扩展插件，用于增强数据表的可视化体验。

## 项目核心

**本质**：解决聚美美平台数据表可读性差的真实问题
**目标**：让数据分析师一眼看出字段类型和业务主键
**哲学**：绝不破坏原有功能，只做渐进式增强

## 技术架构

### 技术栈
- **纯JavaScript ES6+**：零依赖，拒绝过度工程化
- **Chrome Extension Manifest V3**：现代扩展标准
- **CSS3**：字段类型配色系统
- **Bash**：简单打包脚本

### 核心模块
```
enhance.js - 内容脚本逻辑
├── 业务主键提取 (getBusinessKeyFromRow)  
├── 字段类型识别 (getFieldType)
├── 表格导出 (exportTableToClipboard)
└── DOM监控 (MutationObserver)

enhance.css - 视觉系统
├── MySQL字段配色 (蓝色系)
├── Oracle字段配色 (绿色系) 
├── SQLServer字段配色 (橙色系)
└── 业务主键高亮 (黄色背景)
```

## 代码规范

### Linus式代码要求

**好品味标准**:
- 函数不超过一屏，只做一件事
- 消除所有if-else特殊情况
- 数据结构优先，代码其次
- 3层缩进是硬限制

**实用主义铁律**:
- 解决真实问题，不解决假想问题
- Never break userspace - 不破坏原有功能
- 用最笨但最清晰的方式实现
- 性能优化只针对实测瓶颈

### 当前代码质量评估

**品味评分**: 🟡 凑合
- ✅ 函数职责单一，长度适中
- ✅ 零依赖，自包含设计
- ⚠️ 硬编码选择器存在维护风险
- ⚠️ 500ms定时器+MutationObserver双重机制略显冗余

**关键改进点**:
1. `exportTableToClipboard`函数嵌套过深，应拆分为数据提取+格式化
2. 业务主键默认值处理可以统一，消除特殊情况
3. 建议建立字段类型到颜色的映射表，替代冗长CSS选择器

## 开发指南

### 本地开发
```bash
# 直接加载扩展
1. 打开 chrome://extensions/
2. 开启开发者模式
3. 加载已解压的扩展 -> 选择src目录

# 测试打包
./build.sh
```

### 代码修改原则
1. **保持简洁** - 每增加一个功能先问"真的需要吗？"
2. **向后兼容** - 任何改动都不能让老用户抓狂
3. **性能优先** - 在聚美美大数据表上测试性能
4. **渐进增强** - 失败时默默降级，不弹错误

### 部署流程
```bash
# 版本发布
./build.sh  # 自动生成gilbling-v{版本号}.zip

# 上传Chrome商店
# 1. 访问 https://chrome.google.com/webstore/devconsole
# 2. 上传zip包，填写更新说明
# 3. 提交审核
```

## 功能演进

### 已支持
- ✅ MySQL/Oracle/SQLServer字段类型配色
- ✅ 业务主键自动识别和高亮
- ✅ 表格数据一键导出到Excel
- ✅ 动态内容实时更新

### 待评估
- ❓ PostgreSQL/TiDB等其他数据库支持
- ❓ 字段类型自定义配色
- ❓ 数据字典快速搜索
- ❓ 表格列宽记忆功能

**评估标准**:
1. 这是真问题还是臆想问题？
2. 有更简单的方法吗？
3. 会破坏现有功能吗？
4. 复杂度与问题严重性匹配吗？

## 性能考量

### 实测基准
- **DOM查询**: 在1000行表格上 < 50ms
- **内存占用**: 观察者模式自动清理
- **CPU使用**: MutationObserver替代轮询

### 优化策略
- CSS选择器从右向左优化
- 缓存频繁查询的DOM节点
- 批量DOM操作减少重排
- 及时清理事件监听器

## 故障排除

### 常见问题
1. **扩展未生效** - 检查是否在https://dd.gildata.com/域名下
2. **颜色显示异常** - 清除浏览器缓存，重新加载扩展
3. **导出功能失败** - 确认浏览器有剪贴板权限

### 调试技巧
```javascript
// 在控制台手动触发
window.postMessage({ type: 'DEBUG_GILBLING' }, '*');

// 查看扩展日志  
chrome.extension.getBackgroundPage().console.log('调试信息');
```

## 贡献指南

### 提交规范
- 只接受解决真实问题的PR
- 每个PR必须包含性能测试数据
- 拒绝"理论完美"但复杂的方案
- 代码必须遵循现有风格，不引入新依赖

### Review标准
1. **品味检查** - 是否消除了特殊情况？
2. **复杂度审查** - 能否再简化？
3. **破坏性分析** - 会影响现有用户吗？
4. **实用性验证** - 生产环境真的需要吗？

---

**最后**: 记住，这是解决聚美美用户每天面对的真实痛苦的工具。我们不是在做艺术，我们在做能让数据分析师少受点罪的实用工具。保持简单，保持有用，别搞砸了。